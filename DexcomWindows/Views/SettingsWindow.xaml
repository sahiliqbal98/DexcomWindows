<Window
    x:Class="DexcomWindows.Views.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Settings">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" 
                   Text="Settings" 
                   FontSize="24" 
                   FontWeight="SemiBold"
                   Margin="24,16,24,8"/>

        <!-- Tab Buttons -->
        <Grid Grid.Row="1" Padding="24,8,24,16">
            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                  CornerRadius="6" 
                  Padding="4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button x:Name="GeneralTabButton" 
                        Grid.Column="0" 
                        Content="General" 
                        Click="TabButton_Click"
                        Tag="General"
                        HorizontalAlignment="Stretch"
                        Background="{ThemeResource AccentFillColorDefaultBrush}"
                        Foreground="White"/>
                <Button x:Name="AlertsTabButton" 
                        Grid.Column="1" 
                        Content="Alerts" 
                        Click="TabButton_Click"
                        Tag="Alerts"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource SubtleButtonStyle}"/>
            </Grid>
        </Grid>

        <!-- Content -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Padding="24,0,24,24" Spacing="16">

                <!-- ==================== GENERAL TAB ==================== -->
                <StackPanel x:Name="GeneralPanel" Spacing="16">

                    <!-- Account Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Account" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Status Indicator -->
                                <Ellipse x:Name="ConnectionIndicator" 
                                         Grid.Column="0"
                                         Width="10" Height="10" 
                                         Fill="#34C759"
                                         VerticalAlignment="Center"
                                         Margin="0,0,12,0"/>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock x:Name="AccountStatusText" Text="Connected" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="ServerText" Text="United States"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               FontSize="12"/>
                                    <TextBlock x:Name="NextRefreshText" Text=""
                                               Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                               FontSize="11"/>
                                </StackPanel>

                                <Button Grid.Column="2" 
                                        Content="Sign Out" 
                                        Click="SignOutButton_Click"
                                        Foreground="#FF3B30"/>
                            </Grid>
                        </Border>
                    </StackPanel>

                    <!-- Appearance Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Appearance" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="16">
                                <!-- Color Theme with Swatches -->
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Color Theme" FontSize="13"/>
                                    <ListView x:Name="ThemeListView"
                                              SelectionMode="Single"
                                              SelectionChanged="ThemeListView_SelectionChanged">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Padding="4,8" ColumnSpacing="12">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Color Swatch -->
                                                    <Border Grid.Column="0" 
                                                            Width="24" Height="24" 
                                                            CornerRadius="4"
                                                            Background="{Binding SwatchBrush}"/>

                                                    <!-- Theme Name -->
                                                    <TextBlock Grid.Column="1" 
                                                               Text="{Binding Name}"
                                                               VerticalAlignment="Center"/>

                                                    <!-- Checkmark -->
                                                    <FontIcon Grid.Column="2" 
                                                              Glyph="&#xE73E;" 
                                                              FontSize="14"
                                                              Foreground="#34C759"
                                                              Visibility="{Binding IsSelected}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Timer Bar Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Timer Bar" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="12">
                                <RadioButton x:Name="ElapsedRadio" 
                                             GroupName="TimerBar"
                                             Checked="TimerBarMode_Changed">
                                    <StackPanel>
                                        <TextBlock Text="Time Elapsed" FontWeight="SemiBold"/>
                                        <TextBlock Text="Bar fills up as time passes since last reading"
                                                   FontSize="11"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </RadioButton>
                                <RadioButton x:Name="RemainingRadio" 
                                             GroupName="TimerBar"
                                             Checked="TimerBarMode_Changed">
                                    <StackPanel>
                                        <TextBlock Text="Time Remaining" FontWeight="SemiBold"/>
                                        <TextBlock Text="Bar empties as next update approaches"
                                                   FontSize="11"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </RadioButton>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Chart Target Range Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Chart Target Range" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="16">
                                <!-- Low Target -->
                                <StackPanel Spacing="4">
                                    <Grid>
                                        <TextBlock Text="Low Target"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <TextBlock x:Name="TargetLowValue" Text="80" FontWeight="SemiBold"/>
                                            <TextBlock Text=" mg/dL" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Slider x:Name="TargetLowSlider"
                                            Minimum="60" Maximum="120"
                                            Value="80"
                                            ValueChanged="TargetLowSlider_ValueChanged"/>
                                </StackPanel>

                                <!-- High Target -->
                                <StackPanel Spacing="4">
                                    <Grid>
                                        <TextBlock Text="High Target"/>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                            <TextBlock x:Name="TargetHighValue" Text="160" FontWeight="SemiBold"/>
                                            <TextBlock Text=" mg/dL" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                    <Slider x:Name="TargetHighSlider"
                                            Minimum="120" Maximum="200"
                                            Value="160"
                                            ValueChanged="TargetHighSlider_ValueChanged"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Startup Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Startup" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <ToggleSwitch x:Name="StartupToggle"
                                          Header="Start with Windows"
                                          Toggled="StartupToggle_Toggled"/>
                        </Border>
                    </StackPanel>

                    <!-- About Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="About" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="Dexcom Windows" FontWeight="SemiBold"/>
                                    <TextBlock Text="v1.0.0" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </StackPanel>
                                <TextBlock Text="Data source: Dexcom Share API"
                                           FontSize="12"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock Text="This app is not affiliated with Dexcom, Inc. For informational purposes only."
                                           FontSize="11"
                                           TextWrapping="Wrap"
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- ==================== ALERTS TAB ==================== -->
                <StackPanel x:Name="AlertsPanel" Spacing="16" Visibility="Collapsed">

                    <!-- Notification Status -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8" Padding="16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <TextBlock Text="Notifications" FontWeight="SemiBold"/>
                                <TextBlock x:Name="NotificationStatusText" 
                                           Text="Authorized"
                                           FontSize="12"
                                           Foreground="#34C759"/>
                            </StackPanel>

                            <Button Grid.Column="1" 
                                    Content="Send Test" 
                                    Click="TestNotification_Click"
                                    Style="{StaticResource SubtleButtonStyle}"/>
                        </Grid>
                    </Border>

                    <!-- Master Toggle -->
                    <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8" Padding="16">
                        <ToggleSwitch x:Name="AlertsEnabledToggle"
                                      Header="Enable Notifications"
                                      Toggled="AlertsEnabledToggle_Toggled"/>
                    </Border>

                    <!-- Notification Style -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Notification Style" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="8">
                                <CheckBox x:Name="ShowBannersCheck" 
                                          Content="Show banner notifications"
                                          Checked="NotificationStyle_Changed" 
                                          Unchecked="NotificationStyle_Changed"/>
                                <CheckBox x:Name="PlaySoundCheck" 
                                          Content="Play sound"
                                          Checked="NotificationStyle_Changed" 
                                          Unchecked="NotificationStyle_Changed"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Low Glucose Alerts -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Low Glucose Alerts" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="16">
                                <!-- Urgent Low -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Urgent Low" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="UrgentLowThresholdText" 
                                                   Text="Below 55 mg/dL"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" 
                                                  x:Name="UrgentLowToggle"
                                                  Toggled="AlertToggle_Changed"/>
                                </Grid>

                                <Slider x:Name="UrgentLowSlider"
                                        Minimum="40" Maximum="70"
                                        Value="55"
                                        ValueChanged="UrgentLowSlider_ValueChanged"/>

                                <!-- Low -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Low" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="LowThresholdText" 
                                                   Text="Below 70 mg/dL"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" 
                                                  x:Name="LowToggle"
                                                  Toggled="AlertToggle_Changed"/>
                                </Grid>

                                <Slider x:Name="LowSlider"
                                        Minimum="55" Maximum="100"
                                        Value="70"
                                        ValueChanged="LowSlider_ValueChanged"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- High Glucose Alerts -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="High Glucose Alerts" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="16">
                                <!-- High -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="High" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="HighThresholdText" 
                                                   Text="Above 180 mg/dL"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" 
                                                  x:Name="HighToggle"
                                                  Toggled="AlertToggle_Changed"/>
                                </Grid>

                                <Slider x:Name="HighSlider"
                                        Minimum="140" Maximum="250"
                                        Value="180"
                                        ValueChanged="HighSlider_ValueChanged"/>

                                <!-- Urgent High -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="Urgent High" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="UrgentHighThresholdText" 
                                                   Text="Above 250 mg/dL"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" 
                                                  x:Name="UrgentHighToggle"
                                                  Toggled="AlertToggle_Changed"/>
                                </Grid>

                                <Slider x:Name="UrgentHighSlider"
                                        Minimum="200" Maximum="400"
                                        Value="250"
                                        ValueChanged="UrgentHighSlider_ValueChanged"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Rate of Change Alerts -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Rate of Change" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="8">
                                <ToggleSwitch x:Name="RisingQuicklyToggle"
                                              Toggled="AlertToggle_Changed">
                                    <ToggleSwitch.Header>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="⇈" FontSize="16"/>
                                            <TextBlock Text="Rising Quickly"/>
                                        </StackPanel>
                                    </ToggleSwitch.Header>
                                </ToggleSwitch>
                                <ToggleSwitch x:Name="RisingToggle"
                                              Toggled="AlertToggle_Changed">
                                    <ToggleSwitch.Header>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="↑" FontSize="16"/>
                                            <TextBlock Text="Rising"/>
                                        </StackPanel>
                                    </ToggleSwitch.Header>
                                </ToggleSwitch>
                                <ToggleSwitch x:Name="FallingToggle"
                                              Toggled="AlertToggle_Changed">
                                    <ToggleSwitch.Header>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="↓" FontSize="16"/>
                                            <TextBlock Text="Falling"/>
                                        </StackPanel>
                                    </ToggleSwitch.Header>
                                </ToggleSwitch>
                                <ToggleSwitch x:Name="FallingQuicklyToggle"
                                              Toggled="AlertToggle_Changed">
                                    <ToggleSwitch.Header>
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <TextBlock Text="⇊" FontSize="16"/>
                                            <TextBlock Text="Falling Quickly"/>
                                        </StackPanel>
                                    </ToggleSwitch.Header>
                                </ToggleSwitch>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Other Alerts -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Other" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="12">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel>
                                        <TextBlock Text="No Data Alert" FontWeight="SemiBold"/>
                                        <TextBlock x:Name="StaleDataThresholdText" 
                                                   Text="After 15 minutes"
                                                   FontSize="12"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    <ToggleSwitch Grid.Column="1" 
                                                  x:Name="StaleDataToggle"
                                                  Toggled="AlertToggle_Changed"/>
                                </Grid>

                                <ComboBox x:Name="StaleDataIntervalCombo"
                                          Header="Alert after"
                                          HorizontalAlignment="Stretch"
                                          SelectionChanged="StaleDataInterval_Changed">
                                    <ComboBoxItem Content="10 minutes" Tag="10"/>
                                    <ComboBoxItem Content="15 minutes" Tag="15"/>
                                    <ComboBoxItem Content="20 minutes" Tag="20"/>
                                    <ComboBoxItem Content="30 minutes" Tag="30"/>
                                </ComboBox>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Alert Cooldowns -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="Alert Cooldowns" Style="{StaticResource SubtitleTextBlockStyle}"/>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                CornerRadius="8" Padding="16">
                            <StackPanel Spacing="12">
                                <ComboBox x:Name="NormalCooldownCombo"
                                          Header="Normal alerts"
                                          HorizontalAlignment="Stretch"
                                          SelectionChanged="NormalCooldown_Changed">
                                    <ComboBoxItem Content="5 minutes" Tag="5"/>
                                    <ComboBoxItem Content="10 minutes" Tag="10"/>
                                    <ComboBoxItem Content="15 minutes" Tag="15"/>
                                    <ComboBoxItem Content="30 minutes" Tag="30"/>
                                    <ComboBoxItem Content="60 minutes" Tag="60"/>
                                </ComboBox>

                                <ComboBox x:Name="UrgentCooldownCombo"
                                          Header="Urgent alerts"
                                          HorizontalAlignment="Stretch"
                                          SelectionChanged="UrgentCooldown_Changed">
                                    <ComboBoxItem Content="2 minutes" Tag="2"/>
                                    <ComboBoxItem Content="5 minutes" Tag="5"/>
                                    <ComboBoxItem Content="10 minutes" Tag="10"/>
                                    <ComboBoxItem Content="15 minutes" Tag="15"/>
                                </ComboBox>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Reset Button -->
                    <Button Content="Reset All to Defaults"
                            HorizontalAlignment="Center"
                            Click="ResetAlerts_Click"
                            Margin="0,8,0,0"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="3" 
                BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" 
                BorderThickness="0,1,0,0"
                Padding="24,12">
            <Button Content="Done" 
                    Click="DoneButton_Click"
                    HorizontalAlignment="Right"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="24,8"/>
        </Border>
    </Grid>
</Window>
