<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="DexcomWindows.Views.TrayPopupView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:DexcomWindows.Views"
    xmlns:controls="using:DexcomWindows.Controls"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <!-- ==================== LOGIN VIEW ==================== -->
        <ScrollViewer x:Name="LoginPanel" Visibility="Visible" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel Padding="40,24,40,24" MaxWidth="500" HorizontalAlignment="Center" Spacing="12">
                <!-- App Icon and Title -->
                <StackPanel HorizontalAlignment="Center" Spacing="8">
                    <Image Source="ms-appx:///Assets/Icons/app-logo.png" Width="80" Height="80" HorizontalAlignment="Center"/>
                    <TextBlock Text="Steady Sugar" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center"/>
                </StackPanel>

                <!-- Region Picker -->
                <ComboBox x:Name="ServerComboBox" Header="Region" HorizontalAlignment="Stretch" 
                          SelectedIndex="0" FontSize="14">
                    <ComboBoxItem Content="United States" Tag="US"/>
                    <ComboBoxItem Content="Outside US (International)" Tag="International"/>
                </ComboBox>

                <!-- Username Field -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Username, Email, or Phone" FontSize="14" FontWeight="SemiBold"/>
                    <TextBox x:Name="UsernameTextBox" PlaceholderText="Dexcom username, email, or phone number" FontSize="14"/>
                </StackPanel>

                <!-- Password Field -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Password" FontSize="14" FontWeight="SemiBold"/>
                    <PasswordBox x:Name="PasswordBox" PlaceholderText="Password" FontSize="14" KeyDown="PasswordBox_KeyDown"/>
                </StackPanel>

                <!-- Error Bar -->
                <InfoBar x:Name="LoginErrorBar" IsOpen="False" Severity="Error" Title="Error"/>

                <!-- Sign In Button -->
                <Button x:Name="LoginButton" Content="Sign In" Style="{StaticResource AccentButtonStyle}"
                        HorizontalAlignment="Stretch" Click="LoginButton_Click"
                        Padding="0,12" FontSize="16" FontWeight="SemiBold"/>

                <!-- Loading -->
                <ProgressRing x:Name="LoginProgress" IsActive="False" Visibility="Collapsed" 
                              HorizontalAlignment="Center" Width="32" Height="32"/>

                <!-- Taskbar Tip -->
                <Border Background="#2634C759" CornerRadius="8" Padding="12,10">
                    <TextBlock Text="ğŸ’¡ Tip: Right-click taskbar â†’ Taskbar settings â†’ Turn on Steady Sugar to always show."
                               TextWrapping="Wrap" FontSize="12" Foreground="#34C759"
                               HorizontalAlignment="Center" TextAlignment="Center"/>
                </Border>

                <!-- Dexcom Info -->
                <Border Background="#2634C759" CornerRadius="8" Padding="12,10">
                    <TextBlock Text="Use the same login as your Dexcom app (username, email, or phone number)."
                               TextWrapping="Wrap" FontSize="12" Foreground="#34C759"
                               HorizontalAlignment="Center" TextAlignment="Center"/>
                </Border>

                <!-- Setup Help Expander -->
                <Expander Header="Setup Instructions" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" FontSize="13">
                    <StackPanel Spacing="8" Padding="8">
                        <Border Background="#26FF9500" CornerRadius="6" Padding="10">
                            <TextBlock Text="âš ï¸ You must have at least one follower who has ACCEPTED the Share invitation."
                                       TextWrapping="Wrap" FontSize="12" Foreground="#FF9500"/>
                        </Border>
                        <TextBlock Text="1. Open Dexcom G7 app â†’ Settings â†’ Share â†’ Enable" FontSize="12"/>
                        <TextBlock Text="2. Add a follower (can be yourself with different email)" FontSize="12" TextWrapping="Wrap"/>
                        <TextBlock Text="3. Follower must accept invite and set up Dexcom Follow" FontSize="12" TextWrapping="Wrap" Foreground="#FF3B30" FontWeight="SemiBold"/>
                        <TextBlock Text="4. Wait a few minutes, then sign in here" FontSize="12"/>
                    </StackPanel>
                </Expander>

                <!-- Footer -->
                <Grid Margin="0,8,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <HyperlinkButton Grid.Column="0" Content="Contact Dev" NavigateUri="mailto:steadysugar1@gmail.com" FontSize="12"/>
                    <Button Grid.Column="1" Content="Quit" Click="QuitButton_Click" 
                            Style="{StaticResource SubtleButtonStyle}" FontSize="12" Padding="16,8" HorizontalAlignment="Right"/>
                </Grid>
            </StackPanel>
        </ScrollViewer>

        <!-- ==================== MAIN CONTENT (AUTHENTICATED) ==================== -->
        <Grid x:Name="MainContent" Visibility="Collapsed">
            <!-- Main glucose data view -->
            <Grid x:Name="GlucoseDataGrid">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- HEADER -->
                <Grid x:Name="HeaderGrid" Grid.Row="0" Padding="32,20,32,20">
                    <Grid.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop x:Name="HeaderGradientStart" Color="#3034C759" Offset="0"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </LinearGradientBrush>
                    </Grid.Background>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Glucose Value + Trend Arrow -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                            <TextBlock x:Name="GlucoseValueText" Text="--" FontSize="64" FontWeight="Bold" 
                                       FontFamily="Segoe UI Variable" x:FieldModifier="public"/>
                            <TextBlock x:Name="TrendArrowText" Text="" FontSize="44" FontWeight="Bold" 
                                       FontFamily="Segoe UI Variable" VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Trend Description + Time Ago (center) -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="4">
                            <TextBlock x:Name="TrendDescriptionText" Text="" FontSize="16" FontFamily="Segoe UI Variable"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Center"/>
                            <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                                <FontIcon x:Name="StaleWarningIcon" Glyph="&#xE7BA;" FontSize="14" Foreground="#FF9500" Visibility="Collapsed"/>
                                <TextBlock x:Name="TimeAgoText" Text="" FontSize="14" FontFamily="Segoe UI Variable"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- mg/dL + Spinner (right) -->
                        <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right" Spacing="6">
                            <TextBlock Text="mg/dL" FontSize="14" FontFamily="Segoe UI Variable"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" HorizontalAlignment="Right"/>
                            <ProgressRing x:Name="RefreshSpinner" IsActive="False" Visibility="Collapsed" Width="24" Height="24" HorizontalAlignment="Right"/>
                    </StackPanel>
                </Grid>
                </Grid>

                <!-- CONTENT - NO SCROLL, EVERYTHING FITS -->
                <Grid Grid.Row="1" Margin="32,16,32,16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>      <!-- Chart takes remaining space -->
                        <RowDefinition Height="Auto"/>   <!-- Progress Bar -->
                        <RowDefinition Height="Auto"/>   <!-- Time Range -->
                        <RowDefinition Height="Auto"/>   <!-- Stats -->
                        <RowDefinition Height="Auto"/>   <!-- Error (if any) -->
                    </Grid.RowDefinitions>

                    <!-- CHART - Fills available space -->
                    <Border Grid.Row="0" Padding="20,16" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                            CornerRadius="12" Margin="0,0,0,12">
                        <controls:GlucoseChart x:Name="GlucoseChart"/>
                    </Border>

                    <!-- PROGRESS BAR - Between chart and time picker -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12" Margin="0,0,0,12">
                        <TextBlock x:Name="TimerDirectionArrow" Text="â†’" FontSize="13" FontWeight="SemiBold"
                                   FontFamily="Segoe UI Variable"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                        <Border Height="6" Width="140" CornerRadius="3" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                            <Border x:Name="ProgressBarFill" HorizontalAlignment="Left" Width="0" CornerRadius="3">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#0078D7" Offset="0"/>
                                        <GradientStop Color="#00B4FF" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                        </Border>
                        <TextBlock x:Name="TimerText" Text="0:00" FontSize="13" FontWeight="SemiBold"
                                   FontFamily="Segoe UI Variable" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                        <TextBlock x:Name="TimerLabel" Visibility="Collapsed" Text="Time since reading"/>
                    </StackPanel>

                    <!-- TIME RANGE PICKER -->
                    <Grid Grid.Row="2" x:Name="TimeRangePicker" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                          CornerRadius="10" Padding="6" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button x:Name="Range1H" Grid.Column="0" Content="1H" Click="TimeRange_Click" Tag="OneHour"
                                HorizontalAlignment="Stretch" CornerRadius="8"
                                PointerEntered="TimeRangeButton_PointerEntered" PointerExited="TimeRangeButton_PointerExited"
                                Padding="16,10" FontSize="15" FontWeight="SemiBold" FontFamily="Segoe UI Variable"
                                Background="Transparent" BorderThickness="0"/>
                        <Button x:Name="Range3H" Grid.Column="1" Content="3H" Click="TimeRange_Click" Tag="ThreeHours"
                                HorizontalAlignment="Stretch" CornerRadius="8"
                                PointerEntered="TimeRangeButton_PointerEntered" PointerExited="TimeRangeButton_PointerExited"
                                Padding="16,10" FontSize="15" FontWeight="SemiBold" FontFamily="Segoe UI Variable"
                                Background="Transparent" BorderThickness="0"/>
                        <Button x:Name="Range6H" Grid.Column="2" Content="6H" Click="TimeRange_Click" Tag="SixHours"
                                HorizontalAlignment="Stretch" CornerRadius="8"
                                PointerEntered="TimeRangeButton_PointerEntered" PointerExited="TimeRangeButton_PointerExited"
                                Padding="16,10" FontSize="15" FontWeight="SemiBold" FontFamily="Segoe UI Variable"
                                Background="Transparent" BorderThickness="0"/>
                        <Button x:Name="Range12H" Grid.Column="3" Content="12H" Click="TimeRange_Click" Tag="TwelveHours"
                                HorizontalAlignment="Stretch" CornerRadius="8"
                                PointerEntered="TimeRangeButton_PointerEntered" PointerExited="TimeRangeButton_PointerExited"
                                Padding="16,10" FontSize="15" FontWeight="SemiBold" FontFamily="Segoe UI Variable"
                                Background="Transparent" BorderThickness="0"/>
                        <Button x:Name="Range24H" Grid.Column="4" Content="24H" Click="TimeRange_Click" Tag="TwentyFourHours"
                                HorizontalAlignment="Stretch" CornerRadius="8"
                                PointerEntered="TimeRangeButton_PointerEntered" PointerExited="TimeRangeButton_PointerExited"
                                Padding="16,10" FontSize="15" FontWeight="SemiBold" FontFamily="Segoe UI Variable"
                                Background="Transparent" BorderThickness="0"/>
                    </Grid>

                    <!-- STATISTICS ROW -->
                    <Border Grid.Row="3" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="10" Padding="24,14,32,14">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="24h:" FontSize="14" FontWeight="SemiBold"
                                       FontFamily="Segoe UI Variable" 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                            
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                                <TextBlock Text="Avg" FontSize="14" FontFamily="Segoe UI Variable"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock x:Name="AverageText" Text="--" FontSize="24" FontWeight="Bold" 
                                           FontFamily="Segoe UI Variable" VerticalAlignment="Center"/>
                    </StackPanel>

                            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                                <TextBlock Text="SD" FontSize="14" FontFamily="Segoe UI Variable"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock x:Name="StdDevText" Text="--" FontSize="24" FontWeight="Bold" 
                                           FontFamily="Segoe UI Variable" VerticalAlignment="Center"/>
                    </StackPanel>

                            <StackPanel Grid.Column="3" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
                                <TextBlock Text="Range" FontSize="14" FontFamily="Segoe UI Variable"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock x:Name="TimeInRangeText" Text="--%"  FontSize="24" FontWeight="Bold" 
                                           FontFamily="Segoe UI Variable" VerticalAlignment="Center" Foreground="#34C759"/>
                    </StackPanel>
                        </Grid>
                    </Border>

                    <!-- ERROR BANNER (hidden by default) -->
                    <InfoBar Grid.Row="4" x:Name="ErrorBar" IsOpen="False" Severity="Error" IsClosable="True" Margin="0,12,0,0"/>
                </Grid>

                <!-- FOOTER -->
                <Border Grid.Row="2" BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}" BorderThickness="0,1,0,0" Padding="32,12">
                    <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                        <!-- Last Updated -->
                        <TextBlock Grid.Column="0" x:Name="LastUpdatedText" Text="Updated --" FontSize="13"
                                   FontFamily="Segoe UI Variable"
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"
                                   HorizontalAlignment="Left"/>

                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6">
                            <Button x:Name="AlertToggleButton" Click="AlertToggle_Click" ToolTipService.ToolTip="Toggle alerts"
                                    Padding="10" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon x:Name="AlertIcon" Glyph="&#xEA8F;" FontSize="18"/>
                            </Button>
                            <Button Click="RefreshButton_Click" ToolTipService.ToolTip="Refresh now"
                                    Padding="10" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE72C;" FontSize="18"/>
                            </Button>
                            <Button x:Name="SettingsToggleButton" Click="SettingsButton_Click" ToolTipService.ToolTip="Settings"
                                    Padding="10" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE713;" FontSize="18"/>
                            </Button>
                            <Button Click="LogoutButton_Click" ToolTipService.ToolTip="Sign out"
                                    Padding="10" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xF3B1;" FontSize="18"/>
                            </Button>
                            <Button Click="QuitButton_Click" ToolTipService.ToolTip="Quit"
                                    Padding="10" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE7E8;" FontSize="18"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <!-- Settings Panel (OVERLAY - covers entire content) -->
            <Border x:Name="SettingsPanel" 
                    Visibility="Collapsed"
                    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Settings Header -->
                    <Grid Grid.Row="0" Padding="24,20" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Settings" FontSize="28" FontWeight="Bold"/>
                        <Button Grid.Column="1" Click="CloseSettingsButton_Click" Style="{StaticResource SubtleButtonStyle}" Padding="12">
                            <FontIcon Glyph="&#xE711;" FontSize="20"/>
                    </Button>
                    </Grid>

                    <!-- Settings Content -->
                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto"
                                  VerticalScrollMode="Enabled"
                                  HorizontalScrollMode="Disabled"
                                  IsVerticalScrollChainingEnabled="False"
                                  IsVerticalRailEnabled="False"
                                  IsScrollInertiaEnabled="True"
                                  IsDeferredScrollingEnabled="False"
                                  ZoomMode="Disabled"
                                  ManipulationMode="System">
                        <StackPanel Padding="24" Spacing="24">

                            <!-- Account Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Account" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock x:Name="SettingsAccountStatus" Text="Signed in" FontSize="16"/>
                                            <TextBlock x:Name="SettingsServerName" Text="United States" FontSize="14"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        </StackPanel>
                                        <Button Grid.Column="1" Content="Sign Out" Click="LogoutButton_Click"
                                                Background="#26FF3B30" Foreground="#FF3B30" FontSize="14" Padding="16,10"/>
                                    </Grid>
                                </Border>
                            </StackPanel>

                            <!-- Appearance Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Appearance" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <StackPanel Spacing="16">
                                        <ComboBox x:Name="SettingsThemeComboBox" Header="Color Theme" HorizontalAlignment="Stretch"
                                                  SelectionChanged="SettingsTheme_Changed" FontSize="15">
                                            <ComboBoxItem Content="System" Tag="System"/>
                                            <ComboBoxItem Content="Light" Tag="Light"/>
                                            <ComboBoxItem Content="Dark" Tag="Dark"/>
                                            <ComboBoxItem Content="Charcoal" Tag="Charcoal"/>
                                            <ComboBoxItem Content="CGM Green" Tag="DexcomGreen"/>
                                        </ComboBox>
                                        <ComboBox x:Name="SettingsTimerBarComboBox" Header="Timer Bar Style" HorizontalAlignment="Stretch"
                                                  SelectionChanged="SettingsTimerBar_Changed" FontSize="15">
                                            <ComboBoxItem Content="Time Elapsed (fills up)" Tag="Elapsed"/>
                                            <ComboBoxItem Content="Time Remaining (empties)" Tag="Remaining"/>
                                        </ComboBox>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Target Range Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Chart Target Range" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <StackPanel Spacing="20">
                                        <StackPanel Spacing="8">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="Low Target:" FontSize="15"/>
                                                <TextBlock x:Name="SettingsTargetLowValue" Text="80" FontWeight="SemiBold" FontSize="15"/>
                                                <TextBlock Text="mg/dL" FontSize="15"/>
                                            </StackPanel>
                                            <Slider x:Name="SettingsTargetLowSlider" Minimum="60" Maximum="120" Value="80" StepFrequency="5"
                                                    ValueChanged="SettingsTargetLow_Changed"/>
                                        </StackPanel>
                                        <StackPanel Spacing="8">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="High Target:" FontSize="15"/>
                                                <TextBlock x:Name="SettingsTargetHighValue" Text="160" FontWeight="SemiBold" FontSize="15"/>
                                                <TextBlock Text="mg/dL" FontSize="15"/>
                                            </StackPanel>
                                            <Slider x:Name="SettingsTargetHighSlider" Minimum="120" Maximum="200" Value="160" StepFrequency="5"
                                                    ValueChanged="SettingsTargetHigh_Changed"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Alerts Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Alerts" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <StackPanel Spacing="16">
                                        <ToggleSwitch x:Name="SettingsAlertsEnabled" Header="Enable All Alerts" FontSize="15"
                                                      Toggled="SettingsAlerts_Toggled"/>
                                        <ToggleSwitch x:Name="SettingsLowAlert" Header="Low Glucose Alert (â‰¤70)" FontSize="15"
                                                      Toggled="SettingsAlerts_Toggled"/>
                                        <ToggleSwitch x:Name="SettingsHighAlert" Header="High Glucose Alert (â‰¥180)" FontSize="15"
                                                      Toggled="SettingsAlerts_Toggled"/>
                                        <ToggleSwitch x:Name="SettingsUrgentLowAlert" Header="Urgent Low Alert (â‰¤55)" FontSize="15"
                                                      Toggled="SettingsAlerts_Toggled"/>
                                        <ToggleSwitch x:Name="SettingsUrgentHighAlert" Header="Urgent High Alert (â‰¥250)" FontSize="15"
                                                      Toggled="SettingsAlerts_Toggled"/>
                                        <Button Content="Send Test Notification" Click="SettingsTestNotification_Click"
                                                HorizontalAlignment="Stretch" Padding="0,14" FontSize="15"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Startup Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Startup" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <ToggleSwitch x:Name="SettingsStartWithWindows" Header="Start with Windows" FontSize="15"
                                                  Toggled="SettingsStartup_Toggled"/>
                                </Border>
                            </StackPanel>

                            <!-- About Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="About" FontSize="20" FontWeight="SemiBold"/>
                                <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="12" Padding="20">
                                    <StackPanel Spacing="12">
                                        <StackPanel Orientation="Horizontal" Spacing="16">
                                            <Image Source="ms-appx:///Assets/Icons/app-logo.png" Width="64" Height="64"/>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="Steady Sugar" FontSize="20" FontWeight="SemiBold"/>
                                                <TextBlock Text="Version 1.0.0" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="14"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <TextBlock Text="A Windows system tray app for monitoring Dexcom glucose readings."
                                                   TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="14"/>
                                        <TextBlock TextWrapping="Wrap" FontSize="14" Margin="0,4,0,0">
                                            <Run Text="Contact the developer with issues, bugs, feature requests, or anything else at "/>
                                            <Hyperlink NavigateUri="mailto:steadysugar1@gmail.com">steadysugar1@gmail.com</Hyperlink>
                                        </TextBlock>
                                        <TextBlock Text="This app is not affiliated with or endorsed by Dexcom, Inc. The information displayed is for informational purposes only."
                                                   TextWrapping="Wrap" Foreground="{ThemeResource TextFillColorTertiaryBrush}" FontSize="12" Margin="0,8,0,0"/>
                                    </StackPanel>
                                </Border>
                        </StackPanel>

                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

        </Grid>
    </Grid>
</UserControl>
